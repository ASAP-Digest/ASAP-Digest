---
description: 
globs: 
alwaysApply: true
---
# Status Check Protocol (Project Status Report) v2.2

## 1. Protocol Restrictions
````markdown
A. Core Restrictions
- Status Check is a **READ-ONLY** operation concerning project files and state.
- Must NOT modify any project files (including roadmaps) or database.
- Must NOT initiate any work or state changes beyond its own logging.
- Must wait for explicit "IAW" or "BWS" command before any work initiation by the agent.

B. Entity Creation Limits
- Only allowed to create `StatusCheck` and `StatusReport` entities in Server Memory for logging its own execution.
- The user-facing report content is derived from analyzing roadmap files and recent memory, not directly from general memory state.
- No task priority updates or external state modifications allowed.
````

## 2. Activation Methods
````text
A. Primary Triggers
- Command or alias "SC".
- Integration: Can be called by BWS/EWS protocols as part of their flow.
- Context: Used in WSMP (Work Session Management Protocol v2.5+) for state assessment.

B. Secondary Triggers
- Pre-session validation (if integrated into BWS).
- Post-session summary (if integrated into EWS).
- Ad-hoc project status queries.
````

## 3. Protocol Chain and Command Flow
````text
1. Status Check ("SC")
   - READ-ONLY operation regarding project files.
   - Creates `StatusCheck` and `StatusReport` entities for logging.
   - Reads and analyzes roadmap files (`docs/ROADMAP_TASKS.md`, `docs/ASAP_DIGEST_ROADMAP.md` or LLM versions) and recent Server Memory.
   - Reports structured project status and exits.
   - **ONLY OUTPUT THE FINAL REPORT**

2. Work Initiation (Requires explicit command)
   - Must be triggered by "IAW" or "BWS".
   - Cannot be initiated by Status Check.

3. Command Hierarchy
   Status Check < Work Session < Task Execution

4. State Modification Rules
   - Status Check: READ-ONLY (for project files/state).
   - Work Session: Can modify state after explicit command.
   - Task Execution: Can modify state within active work session.
````

## 4. Protocol Integration Layer
````text
┌─────────────────────────────────────────┐
│         Protocol Integration            │
├─────────────────────────────────────────┤
│ 1. Status Check Protocol (This)         │
│ 2. Work Session Management Proto (v2.5+)│
│ 3. Server Memory Rules (v2.0+)          │
│ 4. Task Tracking Protocol               │
│ 5. Software Development Meta Protocol   │
│ 6. Rule Execution Protocol              │
│ 7. Format Time Protocol                 │ // For timestamp consistency
│ 8. Cross-Protocol Comms & Verification   │
│ 9. Audit Trail System                   │
└─────────────────────────────────────────┘
````
*(Self-correction: Updated WSMP version, added Format Time Protocol, refined layers)*

## 5. Status Check Implementation (Conceptual Steps)
````javascript
async function executeProjectStatusCheck() {
    // 1. Initialize timestamp for report and logging
    const reportTimestamp = await mcp_mcp_datetime_get_datetime({ format: "datetime" });
    const formattedReportTime = await mcp_mcp_datetime_get_datetime({ format: "MM.DD.YY | HH:MM AM/PM TimeZone" }); // Use Format Time protocol
    const logTimestamp = await mcp_mcp_datetime_get_datetime({ format: "log_compact" });

    // 2. Create status check entity in Server Memory
    await mcp_Server_Memory_create_entities({
        entities: [{
            name: `StatusCheck_${logTimestamp}`,
            entityType: "StatusCheck",
            observations: [
                `Project status check initiated at ${reportTimestamp}`,
                "Reading roadmap files and recent memory.",
            ]
        }]
    });

    // 3. Read Roadmap Files
    const roadmapTasksContent = await readFileContents('docs/ROADMAP_TASKS.md');
    const mainRoadmapContent = await readFileContents('docs/ASAP_DIGEST_ROADMAP.md'); // Or LLM version

    // 4. Check Recent Server Memory (e.g., Last 72h)
    // Calculate timestamp for 72 hours ago
    const recentCompletions = await searchRecentMemory('TaskCompletion', 72); // Updated lookback
    const activeErrors = await searchRecentMemory('Error', 0, ['status=active']); // Filter for active errors

    // 5. Parse and Analyze Data
    // Parse roadmapTasksContent to get all tasks with statuses and timestamps.
    // Parse mainRoadmapContent to understand task hierarchy for detailed context.
    // Identify sections based on parsing results and rules defined in Section 7.
    const reportData = parseRoadmapsAndMemory(roadmapTasksContent, mainRoadmapContent, recentCompletions, activeErrors, reportTimestamp);

    // 6. Generate Structured Report (User Facing)
    const userReport = formatUserReport(reportData, formattedReportTime); // Use formatted time

    // 7. Create status report entity in Server Memory
    await mcp_Server_Memory_create_entities({
        entities: [{
            name: `StatusReport_${logTimestamp}`,
            entityType: "StatusReport",
            observations: [
                `Report generated at ${reportTimestamp}`,
                `Summary: ${reportData.summary}`, // Store a brief summary
                `PriorityTask: ${reportData.priorityTask?.id}`,
                `PriorityReason: ${reportData.priorityTask?.reason}`,
                `BlockedTasksCount: ${reportData.blockedTasks?.length || 0}`,
                `PendingTestingCount: ${reportData.pendingTestingTasks?.length || 0}`,
                `ActiveTestingCount: ${reportData.activeTestingTasks?.length || 0}`,
            ]
        }]
    });

    // 8. Return the formatted user report
    return userReport;
}

// Helper function placeholders (implementation requires specific parsing logic)
async function readFileContents(filePath) { /* ... use read_file ... */ }
async function searchRecentMemory(entityType, hoursAgo, filters = []) { /* ... use mcp_Server_Memory_search_nodes with time filtering and provided filters ... */ }
function parseRoadmapsAndMemory(roadmapTasksContent, mainRoadmapContent, recentCompletions, activeErrors, reportTimestamp) { /* ... parsing logic ... */ }
function formatUserReport(reportData, formattedReportTime) { /* ... formatting logic using Markdown tables etc. ... */ }
````
*(Note: The JavaScript is conceptual to illustrate the flow)*

## 6. Information Sources Hierarchy
````text
1.  **Primary:** `docs/ROADMAP_TASKS.md` (for detailed task status and timestamps).
2.  **Secondary:**
    -   Server Memory:
        -   `TaskCompletion` entities (last 72h)
        -   Active `Error` entities (for priority determination and details)
        -   Potentially `Task` entities for state entry timestamps if not in roadmap.
    -   `docs/ASAP_DIGEST_ROADMAP.md` (or LLM versions): For overall context and task hierarchy (Major Task Group, Parent Subtask).
    -   Current Timestamp (`format-time.mdc`): For defining the "recent" window and report time.
````

## 7. Status Report Structure & Logic
*(Self-correction: Incorporated suggestions, using Markdown tables, clearer priority, detailed context, and consistent timestamp format)*
The user-facing output MUST follow this structure:

````markdown
---
# **`📅 Status Check Report (MM.DD.YY | HH:MM AM/PM TimeZone)`**
---
### **`✅ Recently Completed Tasks (Last 72h):`**
- Logic:
  - Get current time (T). Calculate T minus 72 hours (T-72).
  - Find tasks marked ✅ in `ROADMAP_TASKS.md` with a timestamp between T-72 and T.
  - Find `TaskCompletion` entities in Server Memory with a timestamp between T-72 and T.
  - Combine and deduplicate lists, sort by timestamp (most recent first).
  - Display all found entries. If none, state "*No tasks completed in the last 72 hours.*"
- Format: `- Task Name (MM.DD.YY | HH:MM AM/PM TimeZone)`

### **`🧪 Testing Pipeline:`**
- Logic:
  - Find all tasks marked `🔬` (Pending Testing) in `ROADMAP_TASKS.md`. Extract state entry timestamp if available.
  - Find all tasks marked `🧪` (Testing) in `ROADMAP_TASKS.md`. Extract state entry timestamp if available.
  - Format using Markdown tables. If a section is empty, state "*None*".
- Format:
  `🔬 Pending User Initiation:`
  | Task Name | Entered Queue | Priority? |
  |---|---|---|
  | [Task Name] | [MM.DD.YY | HH:MM AM/PM TimeZone] | [Yes/No] |
  | ... | ... | ... |

  `🧪 Actively Testing:`
  | Task Name | Started Testing |
  |---|---|
  | [Task Name] | [MM.DD.YY | HH:MM AM/PM TimeZone] |
  | ... | ... |

### **`🎯 Current / Operational Priority:`**
- Logic (Hierarchical):
  1.  **Blocked (`❌`):** Find the first task marked `❌` in `ROADMAP_TASKS.md`. Reason: "Blocked Task".
  2.  **Error (`Error` Entity):** Search Server Memory for active `Error` entities. If found, the *first* error is priority. Reason: "Active Error". Include error details.
  3.  **Pending Test (`🔬`):** Find the first task marked `🔬` in `ROADMAP_TASKS.md`. Reason: "Ready for User Testing Initiation".
  4.  **Active Test (`🧪`):** Find the first task marked `🧪` in `ROADMAP_TASKS.md`. Reason: "Active Testing Phase".
  5.  **In Progress (`🔄`):** Find the first task marked `🔄` in `ROADMAP_TASKS.md`. Reason: "Next In Progress".
  6.  **Pending (`⏳`):** Find the first task marked `⏳` in `ROADMAP_TASKS.md`. Reason: "Next Pending".
- Format: `- [Emoji] **[Task Name]** (Reason: [Determined Reason from Hierarchy Logic]. [Include Error details if applicable])`


### **`⏳ Upcoming Tasks (After Priority):`**
- Logic:
  - Find the task identified as the current priority.
  - List the next 3-5 tasks that appear *after* the priority task in `ROADMAP_TASKS.md` and are marked `⏳`.
  - Format using Markdown table.
- Format:
  | Task Name |
  |---|
  | [Task Name] |
  | ... |

### **`❌ Blocked Tasks:`**
- Logic: List all tasks marked `❌` in `ROADMAP_TASKS.md`. Format using Markdown table. If none, state "*None*".
- Format:
  | Task Name |
  |---|
  | [Task Name] |
  | ... |

### **`⚙️ Overall Context:`**
- Logic:
  - Identify the current priority task.
  - Determine its immediate parent subtask from the structure in `ROADMAP_TASKS.md` or `ASAP_DIGEST_ROADMAP.md`.
- Format: `Currently working within: [Parent Subtask Name] > **[Priority Task Name]**`
---
````

## 8. Error Prevention and Handling
````text
-   Gracefully handle errors during file reading (`read_file`) or memory searches (`mcp_Server_Memory_search_nodes`).
-   If `ROADMAP_TASKS.md` cannot be read or parsed, the report should indicate this failure clearly.
-   Log any errors encountered during the status check itself into a relevant `Error` entity in Server Memory if possible, or include in the `StatusReport` entity's observations.
````