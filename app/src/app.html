<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="manifest" href="/manifest.json" />
		<meta name="theme-color" content="#00ffff" />
		<title>ASAP Digest</title>
		
		<!-- Preconnect to critical domains -->
		<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
		
		<!-- DNS prefetch for other domains -->
		<link rel="dns-prefetch" href="https://www.google-analytics.com" />
		
		<!-- Google Analytics - async and deferred -->
		<script async defer src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
		<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'G-XXXXXXXXXX', { 'send_page_view': false });
		// We'll send page views manually after the page is fully loaded
		</script>
		
		<!-- Service Worker Registration is now handled by SvelteKit -->
		
		<!-- System font strategy - no external font loading -->
		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
			}
		</style>
		
		<!-- Handle Vite preload errors -->
		<script>
			// Handle module loading errors by reloading the page
			window.addEventListener('vite:preloadError', (event) => {
				console.warn('Module loading failed, reloading page:', event.detail.message);
				// Wait a moment before reloading to avoid infinite reload loops
				setTimeout(() => window.location.reload(), 1000);
			});

			// Prevent service worker registration errors from showing in console
			const originalServiceWorkerRegister = navigator.serviceWorker?.register;
			if (originalServiceWorkerRegister) {
				navigator.serviceWorker.register = function(...args) {
					return originalServiceWorkerRegister.apply(this, args).catch(err => {
						console.debug('Service worker registration suppressed:', err.message);
						return Promise.resolve(null); // Return resolved promise to prevent errors
					});
				};
			}
		</script>
		
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
		
		<!-- Deferred analytics page view -->
		<script>
			// Send page view after the page is fully loaded
			window.addEventListener('load', () => {
				setTimeout(() => {
					if (window.gtag) {
						gtag('event', 'page_view', {
							page_title: document.title,
							page_location: window.location.href,
							page_path: window.location.pathname
						});
					}
				}, 100);
			});
		</script>
	</body>
</html>